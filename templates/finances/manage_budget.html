{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Manage Budget - Budget Tracker{% endblock %}

{% block content %}
<header class="page-header mb-4">
    <h1 class="h2">Manage Budget</h1>
    <p class="text-muted">Set and track your monthly spending limits by category</p>
</header>

<div class="row">
    <div class="col-md-5 mb-4">
        <section class="set-budget" aria-labelledby="set-budget-heading">
            <div class="card border-0 shadow-sm">
                <header class="card-header">
                    <h2 class="h4 mb-0" id="set-budget-heading">Set Budget</h2>
                </header>
                <div class="card-body">
                    <form method="POST">
                        {% csrf_token %}
                        {{ form|crispy }}
                        <button type="submit" class="btn btn-primary w-100 mt-4">Save Budget</button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <div class="col-md-7 mb-4">
        <section class="current-budgets" aria-labelledby="current-budgets-heading">
            <div class="card border-0 shadow-sm">
                <header class="card-header">
                    <h2 class="h4 mb-0" id="current-budgets-heading">Current Month's Budgets</h2>
                </header>
                <div class="card-body">
                    {% if budgets %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <caption class="visually-hidden">List of current month budgets and spending</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Category</th>
                                    <th scope="col">Budget</th>
                                    <th scope="col">Spent</th>
                                    <th scope="col">Remaining</th>
                                    <th scope="col">Progress</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for budget in budgets %}
                                <tr>
                                    <td>{{ budget.category }}</td>
                                    <td>${{ budget.budget }}</td>
                                    <td>${{ budget.spent }}</td>
                                    <td>${{ budget.remaining }}</td>
                                    <td style="width: 30%;">
                                        <div class="progress" style="height: 20px;" aria-label="Budget progress for {{ budget.category }}">
                                            <div class="progress-bar {% if budget.percentage > 80 %}bg-danger{% elif budget.percentage > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                                                 role="progressbar" 
                                                 style="width: {{ budget.percentage }}%;" 
                                                 aria-valuenow="{{ budget.percentage }}" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100">
                                                {{ budget.percentage }}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center p-4">
                        <p>You haven't set any budgets for this month yet.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock %} 